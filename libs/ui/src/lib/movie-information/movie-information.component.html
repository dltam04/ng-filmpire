<ng-container *ngIf="mediaDetails$ | async as mediaDetail; else loading">
  <div
    #topOfPage
    class="scroll-mt-40"
    *ngIf="
      currentSelectedMedia === 'movie' && isMovie(mediaDetail);
      else tvShow
    "
  >
    <div class="container px-4 py-8">
      <div class="flex max-sm:block">
        <div
          class="w-1/3 max-sm:mb-4 max-sm:flex max-sm:w-full max-sm:place-content-center"
        >
          <img
            [src]="
              mediaDetail.poster_path
                ? 'https://image.tmdb.org/t/p/w300' + mediaDetail.poster_path
                : 'assets/media-poster-placeholder.png'
            "
            alt="Movie Poster"
            class="rounded-lg"
          />
        </div>
        <div class="w-2/3 pl-8 max-sm:w-full max-sm:pl-0">
          <h1 class="text-4xl font-semibold">{{ mediaDetail.title }}</h1>
          <p class="mt-2 text-gray-600">
            {{ mediaDetail.release_date | date: 'mediumDate' }}
          </p>
          <div class="mt-4 flex items-center">
            <span class="mr-1 text-xl text-yellow-500">&#9733;</span>
            <span class="text-gray-600"
              >{{ mediaDetail.vote_average | number: '1.1-1' }}/10</span
            >
          </div>
          <p class="mt-6 text-gray-700 dark:text-white">
            {{ mediaDetail.overview }}
          </p>
          <div class="mt-6">
            <div class="mt-6">
              <h2 class="text-2xl font-semibold">Cast</h2>
              <div class="mt-2 flex overflow-x-auto">
                <ng-container *ngFor="let actor of mediaDetail.credits.cast">
                  <a
                    class="min-w-[25%] cursor-pointer max-sm:min-w-[40%]"
                    [routerLink]="['/actor', actor.id]"
                  >
                    <img
                      [src]="
                        actor.profile_path
                          ? 'https://image.tmdb.org/t/p/w500' +
                            actor.profile_path
                          : 'assets/actor_avatar_placeholder.jpg'
                      "
                      alt="{{ actor.name }}"
                      class="mx-auto h-[150px] w-full max-w-[100px] rounded-lg object-cover"
                    />
                    <p class="mt-1 text-center text-sm">{{ actor.name }}</p>
                    <p class="mt-1 text-center text-sm text-gray-600">
                      {{ actor.character }}
                    </p>
                  </a>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template #tvShow>
    <div
      #topOfPage
      class="scroll-mt-40"
      *ngIf="currentSelectedMedia === 'tv' && isTV(mediaDetail)"
    >
      <div class="container mx-auto px-4 py-8">
        <div class="flex max-sm:block">
          <div
            class="w-1/3 max-sm:mb-4 max-sm:flex max-sm:w-full max-sm:place-content-center"
          >
            <img
              [src]="
                mediaDetail.poster_path
                  ? 'https://image.tmdb.org/t/p/w300' + mediaDetail.poster_path
                  : 'assets/media-poster-placeholder.png'
              "
              alt="TV Show Poster"
              class="rounded-lg"
            />
          </div>
          <div class="w-2/3 pl-8 max-sm:w-full max-sm:pl-0">
            <h1 class="text-4xl font-semibold">
              {{ mediaDetail.name }} ({{
                mediaDetail.first_air_date | date: 'yyyy'
              }}
              -
              {{
                mediaDetail.status === 'Ended'
                  ? (mediaDetail.last_air_date | date: 'yyyy')
                  : ''
              }})
            </h1>
            <p class="mt-2 text-gray-600">
              {{ mediaDetail.first_air_date | date: 'mediumDate' }}
            </p>
            <div class="mt-4 flex items-center">
              <span class="mr-1 text-xl text-yellow-500">&#9733;</span>
              <span class="text-gray-600"
                >{{ mediaDetail.vote_average | number: '1.1-1' }}/10</span
              >
            </div>
            <p class="mt-6 text-gray-700 dark:text-white">
              {{ mediaDetail.overview }}
            </p>
            <div class="mt-6">
              <h2 class="text-2xl font-semibold">Cast</h2>
              <div class="mt-2 flex gap-1 overflow-x-auto">
                <ng-container *ngFor="let actor of mediaDetail.credits.cast">
                  <a
                    class="min-w-[25%] cursor-pointer max-sm:min-w-[40%]"
                    [routerLink]="['/actor', actor.id]"
                  >
                    <img
                      [src]="
                        actor.profile_path
                          ? 'https://image.tmdb.org/t/p/w500' +
                            actor.profile_path
                          : 'assets/actor_avatar_placeholder.jpg'
                      "
                      alt="{{ actor.name }}"
                      class="mx-auto h-[150px] w-full max-w-[100px] rounded-lg object-cover"
                    />
                    <p class="mt-1 text-center text-sm">{{ actor.name }}</p>
                    <p class="mt-1 text-center text-sm text-gray-600">
                      {{ actor.character }}
                    </p>
                  </a>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-container *ngIf="mediaDetail.recommendations.results.length > 0">
    <div class="p-4">
      <div class="h-full border-l-4 border-blue-500 pl-4 dark:border-red-700">
        <h2 class="mb-10 text-3xl dark:text-white">You may also like...</h2>
      </div>
      <div class="grid-cols-card grid gap-6">
        <ng-container
          *ngFor="let media of $any(mediaDetail.recommendations.results)"
        >
          <ng-filmpire-media-card-item
            [media]="media"
          ></ng-filmpire-media-card-item>
        </ng-container>
      </div>
    </div>
  </ng-container>
</ng-container>

<ng-template #loading>
  <div class="flex w-full items-center justify-center">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
</ng-template>
